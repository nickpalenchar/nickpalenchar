---
import { Image } from "astro:assets";
import Layout from "../layouts/Layout.astro";
import { homePageContent, identity } from "../config";
import SocialLink from "../components/SocialLink.astro";
import Link from "../components/Link.astro";
import { getCollection } from "astro:content";
import FixedRotatedTitle from "../components/FixedRotatedTitle.astro";

const posts = await getCollection("posts", ({ data }) => {
    return data.draft !== true;
});
posts.sort((a, b) => {
    const dateA = new Date(a.data.date).getTime();
    const dateB = new Date(b.data.date).getTime();
    return dateB - dateA;
});
posts.splice(2);
---

<Layout seo={homePageContent.seo}>
    <FixedRotatedTitle title="Home" tracking="-0.06em" />

    <div
        class="fixed right-4 top-1/2 -translate-y-1/2 -z-10 pointer-events-none"
        style="position: fixed; transform: translateY(-50%); will-change: auto;"
    >
        <p
            class="text-lg transform rotate-90 whitespace-nowrap origin-center opacity-60"
            style="transform: rotate(90deg);"
        >
            Software Engineer
        </p>
    </div>

    <section class="mt-10 max-w-3xl mx-auto px-6 md:pl-20 md:pr-20">
        <h1 class="font-bold text-3xl mb-1">{identity.name}</h1>
        <p class="opacity-60 mb-10">{homePageContent.role}</p>
        <div class="flex flex-col min-[520px]:flex-row gap-6 mb-8">
            <Image
                src={identity.logo}
                alt={identity.name}
                width={100}
                height={100}
                class="rounded-full"
            />
            <div class="group flex flex-col justify-center gap-2 w-fit">
                {
                    homePageContent.socialLinks.map((link) => (
                        <SocialLink
                            title={link.title}
                            url={link.url}
                            icon={link.icon}
                            external={link.external}
                        />
                    ))
                }
            </div>
        </div>
        <p class="max-w-md mb-8">
            {homePageContent.description}
        </p>
        <div class="flex items-center gap-4 group w-fit">
            {
                homePageContent.links.map((link) => (
                    <Link
                        text={link.title}
                        href={link.url}
                        external={link.external}
                    />
                ))
            }
        </div>
    </section>
    <section class="mt-20 max-w-3xl mx-auto px-6">
        <h2 class="mb-8">Latest Posts</h2>
        <div class="grid grid-cols-1 gap-10 sm:gap-6 mb-10">
            {
                posts.map((post) => (
                    <a href={`/blog/${post.id}`} class=" sm:flex sm:gap-6 post">
                        <div class="mt-4 sm:my-auto">
                            <p class="opacity-60 mb-2">
                                {post.data.date.toLocaleDateString()}
                            </p>
                            <h3 class="font-medium hover-underline">
                                {post.data.title}
                            </h3>
                            <p class="text-sm opacity-60 mt-2 mb-3">
                                {post.data.description || ""}
                            </p>
                        </div>
                    </a>
                ))
            }
        </div>
        <div class="text-center">
            <a
                href="/blog"
                class="underline underline-offset-4 opacity-60 hover:opacity-100 transition-opacity"
                >View all</a
            >
        </div>
    </section>
</Layout>
