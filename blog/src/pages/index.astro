---
import { Image } from "astro:assets";
import Layout from "../layouts/Layout.astro";
import { homePageContent, identity, aboutPageContent } from "../config";
import Link from "../components/Link.astro";
import { getCollection } from "astro:content";
import FixedRotatedTitle from "../components/FixedRotatedTitle.astro";
import ResumeItem from "../components/ResumeItem.astro";
import SocialLinkBox from "../components/SocialLinkBox.astro";
import { marked } from "marked";

const posts = await getCollection("posts", ({ data }) => {
    return data.draft !== true;
});
posts.sort((a, b) => {
    const dateA = new Date(a.data.date).getTime();
    const dateB = new Date(b.data.date).getTime();
    return dateB - dateA;
});
posts.splice(2);

const pageDescription = marked.parse(aboutPageContent.about.description);
const workDescription = marked.parse(aboutPageContent.work.description);
const connectDescription = marked.parse(aboutPageContent.connect.description);
---

<Layout seo={homePageContent.seo}>
    <FixedRotatedTitle title="Home" tracking="-0.06em" />

    <div
        class="fixed right-4 top-1/2 -translate-y-1/2 -z-10 pointer-events-none"
        style="position: fixed; transform: translateY(-50%); will-change: auto;"
    >
    </div>

    <section class="mt-10 max-w-3xl mx-auto px-6 md:pl-20">
        <h1 class="font-bold text-3xl mb-1">Welcome</h1>
        <div class="mb-2">
            <script is:inline>
                if (typeof window !== 'undefined' && (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')) {
                  const link = document.createElement('a');
                  link.href = 'http://localhost:3939';
                  link.target = '_blank';
                  link.rel = 'noopener noreferrer';
                  link.textContent = 'Open Editor â†’';
                  link.style.textDecoration = 'underline';
                  link.style.opacity = '0.6';
                  link.style.transition = 'opacity 150ms';
                  link.onmouseover = () => link.style.opacity = '1';
                  link.onmouseout = () => link.style.opacity = '0.6';
                  const container = document.querySelector('#editor-link-container');
                  if (container) container.appendChild(link);
                }
            </script>
            <div id="editor-link-container"></div>
        </div>
        <div class="mb-14">
            <Fragment set:html={pageDescription} />
        </div>
        <div class="flex flex-col min-[410px]:flex-row">
            <Image
                src={aboutPageContent.about.image_l.url}
                alt={aboutPageContent.about.image_l.alt}
                width={350}
                height={250}
                class="w-[350px] h-[250px] object-cover rounded-xl -rotate-6"
            />
            <Image
                src={aboutPageContent.about.image_r.url}
                alt={aboutPageContent.about.image_r.alt}
                width={150}
                height={250}
                class="w-[150px] h-[250px] object-cover rounded-xl rotate-6 mx-auto sm:ml-auto"
            />
        </div>
    </section>
    <section class="my-20 mt-32 max-w-3xl mx-auto px-6 sm:flex sm:gap-16">
        <h2 class="mb-8 sm:mb-0 opacity-60">Work</h2>
        <div>
            <div class="mb-6">
                <Fragment set:html={workDescription} />
            </div>
            <div class="grid grid-cols-1 group">
                {
                    aboutPageContent.work.items.map((item) => (
                        <ResumeItem {...item} />
                    ))
                }
            </div>
        </div>
    </section>
    <section class="mt-32 max-w-3xl mx-auto px-6 sm:flex sm:gap-16">
        <h2 class="mb-8 sm:mb-0 opacity-60">Connect</h2>
        <div>
            <div class="mb-6">
                <Fragment set:html={connectDescription} />
            </div>
            <div class="grid grid-cols-2 gap-2 group">
                {
                    aboutPageContent.connect.links.map((item) => (
                        <SocialLinkBox {...item} />
                    ))
                }
            </div>
        </div>
    </section>
    <section class="mt-20 max-w-3xl mx-auto px-6">
        <h2 class="mb-8">Latest Posts</h2>
        <div class="grid grid-cols-1 gap-10 sm:gap-6 mb-10">
            {
                posts.map((post) => (
                    <a href={`/blog/${post.id}`} class=" sm:flex sm:gap-6 post">
                        <div class="mt-4 sm:my-auto">
                            <p class="opacity-60 mb-2">
                                {post.data.date.toLocaleDateString()}
                            </p>
                            <h3 class="font-medium hover-underline">
                                {post.data.title}
                            </h3>
                            <p class="text-sm opacity-60 mt-2 mb-3">
                                {post.data.description || ""}
                            </p>
                        </div>
                    </a>
                ))
            }
        </div>
        <div class="text-center">
            <a
                href="/blog"
                class="underline underline-offset-4 opacity-60 hover:opacity-100 transition-opacity"
                >View all</a
            >
        </div>
    </section>
</Layout>
